<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disease Diagnosis</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-green-50 flex flex-col">
    {% block navbar %}
        {% include 'user_navbar.html' %}
    {% endblock %}<br>
    <div class="mt-10 flex justify-start w-4/5 ml-10">
        <!-- Symptom Selection Box -->
        <div class="bg-white p-6 rounded-lg shadow-lg w-3/4">  <!-- Increased width -->
            <h2 class="text-center text-2xl font-bold text-green-700">Select Symptoms</h2>
            <label class="block mt-4 text-lg" for="symptom-select">Symptoms:</label>
            <select id="symptom-select" class="w-full p-2 mt-2 border rounded-md" onchange="addSymptom(this.value)">
                <option value="" disabled selected>Select a symptom</option>
            </select>
            <div id="selected-symptoms" class="mt-4 hidden"></div>
            <button onclick="diagnose()" class="w-full mt-4 bg-green-600 text-white py-2 rounded-md hover:bg-green-700 font-semibold">Diagnose</button>
            <h3 class="text-center text-2xl font-bold text-green-700">Upload Image for Diagnosis</h3>
            <input type="file" id="image-upload" accept="image/*" class="w-full border p-2 rounded-md mt-2">
            <button onclick="analyzeImage()" class="w-full mt-4 bg-green-600 text-white py-2 rounded-md hover:bg-green-700 font-semibold">Analyze Image</button>
            <div id="image_result" class="mt-4 text-center"></div>
        </div>
        
        <!-- Diagnosis Result Box -->
        <div id="diagnosis-box" class="bg-white p-6 rounded-lg shadow-lg w-3/4 ml-5">  <!-- Increased width -->
            <h2 class="text-center text-2xl font-bold text-green-700">Diagnosis Result</h2>
            <div id="diagnosis_result" class="mt-4 text-center"></div>
        </div>
    </div>

    <script>
        const symptomsList = ["Coughing", "Sneezing", "Fever", "Swelling", "Lethargy", "Loss of appetite", "Diarrhea", "Watery eyes"];
        let selectedSymptoms = [];
        const diseases = [
            { name: "Infectious Coryza", symptoms: ["Coughing", "Sneezing", "Swelling", "Watery eyes"] },
            { name: "Avian Influenza", symptoms: ["Coughing", "Fever", "Lethargy", "Loss of appetite"] },
            { name: "Newcastle Disease", symptoms: ["Diarrhea", "Fever", "Lethargy", "Sneezing"] }
        ];

        // Populate the dropdown
        const symptomSelect = document.getElementById("symptom-select");
        symptomsList.forEach(symptom => {
            let option = document.createElement("option");
            option.value = symptom;
            option.textContent = symptom;
            symptomSelect.appendChild(option);
        });

        function addSymptom(symptom) {
            if (!selectedSymptoms.includes(symptom) && symptom !== "") {
                selectedSymptoms.push(symptom);
                updateSelectedSymptoms();
            }
        }

        function removeSymptom(symptom) {
            selectedSymptoms = selectedSymptoms.filter(s => s !== symptom);
            updateSelectedSymptoms();
        }

        function updateSelectedSymptoms() {
            const container = document.getElementById("selected-symptoms");
            container.innerHTML = "";
            if (selectedSymptoms.length === 0) {
                container.classList.add("hidden");
                return;
            }
            container.classList.remove("hidden");
            selectedSymptoms.forEach(symptom => {
                const div = document.createElement("div");
                div.classList.add("bg-green-100", "p-2", "rounded-md", "mr-2", "mt-2", "inline-flex", "items-center");
                div.textContent = symptom;
                
                const button = document.createElement("button");
                button.classList.add("ml-2", "bg-red-500", "text-white", "rounded", "px-2", "py-1");
                button.innerHTML = "&times;";
                button.onclick = () => removeSymptom(symptom);

                div.appendChild(button);
                container.appendChild(div);
            });
        }

        function diagnose() {
            if (selectedSymptoms.length === 0) {
                alert("Please select at least one symptom.");
                return;
            }
            document.getElementById("diagnosis-box").classList.remove("hidden");
            document.getElementById("diagnosis_result").innerHTML = "<p class='text-gray-600'>Analyzing symptoms...</p>";
            setTimeout(() => {
                let results = diseases.map(disease => {
                    const matchedSymptoms = selectedSymptoms.filter(symptom => disease.symptoms.includes(symptom));
                    const probability = (matchedSymptoms.length / disease.symptoms.length) * 100;
                    return { name: disease.name, probability: probability.toFixed(1) };
                }).filter(result => result.probability > 0);
                document.getElementById("diagnosis_result").innerHTML = results.length > 0 
                    ? results.map(result => `<p class='text-green-700 font-semibold'>${result.name}: ${result.probability}%</p>`).join(" ") 
                    : "No matching diseases found.";
            }, 2000);
        }
    </script>
</body>
</html>
